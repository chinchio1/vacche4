<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8">
<title>Milkminder Excel (HTML)</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
<h1>Carica Excel Milkminder</h1>
<input type="file" id="fileInput" accept=".xlsx,.xls">
<div id="output"></div>

<script>
document.getElementById('fileInput').addEventListener('change', handleFile, false);

function handleFile(e) {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(evt) {
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, {type: 'array'});
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const get = (cell) => (sheet[cell] ? sheet[cell].v : 0);

    // Adatta i riferimenti in base al tuo file
    const days = +get('B2');
    const milk_sold = +get('B3');
    const milk_not = +get('B4');
    const invoice_eur = +get('B5');
    const cows_in_milk = +get('B6');

    const milk_total = milk_sold + milk_not;
    const price_per_L_sold = milk_sold>0 ? invoice_eur/milk_sold : 0;

    // Esempio: leggi alimenti da riga 12
    let row=12, monthly_cost_total=0, monthly_dm_total=0;
    while(sheet['A'+row]) {
      const type = (get('A'+row)+"").toLowerCase();
      const kgphd = +get('B'+row);
      const priceT= +get('C'+row);
      let dm = +get('D'+row); if (dm>1) dm/=100;
      const heads= +get('E'+row);
      const daily_asfed = kgphd*heads;
      const daily_dm = daily_asfed*dm;
      const monthly_asfed = daily_asfed*days;
      const monthly_dm = daily_dm*days;
      const monthly_cost = (monthly_asfed/1000)*priceT;
      monthly_cost_total += monthly_cost;
      monthly_dm_total += monthly_dm;
      row++;
    }

    const iofc_month = invoice_eur - monthly_cost_total;
    const iofc_per_cow_month = cows_in_milk>0 ? iofc_month/cows_in_milk : 0;

    document.getElementById('output').innerHTML = `
      <h2>Risultati</h2>
      <ul>
        <li>Totale latte prodotto: ${milk_total.toFixed(2)} L</li>
        <li>Prezzo €/L venduto: ${price_per_L_sold.toFixed(4)}</li>
        <li>Totale € alimenti: ${monthly_cost_total.toFixed(2)}</li>
        <li>Totale kg SS: ${monthly_dm_total.toFixed(2)}</li>
